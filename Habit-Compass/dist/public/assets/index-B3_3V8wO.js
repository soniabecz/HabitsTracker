(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const D="habits-tracker-data",x="habits-tracker-theme";let d=[],s=[],c=!1,I=null,w=null,y=!1;function P(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function B(){return new Date().toISOString().split("T")[0]}function T(){for(var e=[],t=6;t>=0;t--){var a=new Date;a.setDate(a.getDate()-t),e.push(a.toISOString().split("T")[0])}return e}function z(e){var t=new Date(e);return t.toLocaleDateString("pl-PL",{weekday:"short",day:"numeric"})}function A(){return new Date().toLocaleDateString("pl-PL",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function N(){try{var e=localStorage.getItem(D);if(e){var t=JSON.parse(e);return{habits:t.habits||[],completions:t.completions||[]}}}catch(a){console.error("Error reading from localStorage:",a)}return{habits:[],completions:[]}}function b(){try{localStorage.setItem(D,JSON.stringify({habits:d,completions:s}))}catch(e){console.error("Error saving to localStorage:",e)}}function U(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,a){return String.fromCharCode(parseInt(a,16))}))}function F(e){return decodeURIComponent(atob(e).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function J(){var e=new URLSearchParams(window.location.search),t=e.get("shared");if(y=!1,t)try{var a=F(t),i=JSON.parse(a);return{habits:i.habits||[],completions:i.completions||[]}}catch(n){console.error("Error decoding shared data:",n),y=!0}return null}function K(){if(y){var e=document.getElementById("habits-list"),t=document.getElementById("empty-habits");if(e&&e.classList.add("hidden"),t){t.classList.remove("hidden");var a=document.getElementById("empty-subtext");a&&(a.textContent="Nie udało się załadować danych. Link może być uszkodzony.",a.style.color="hsl(0, 70%, 55%)")}}}function V(){var e={habits:d,completions:s},t=U(JSON.stringify(e));return window.location.origin+window.location.pathname+"?shared="+encodeURIComponent(t)}function k(e,t){var a=s.find(function(i){return i.habitId===e&&i.date===t});return a?a.completed:!1}function _(e,t){var a=s.findIndex(function(i){return i.habitId===e&&i.date===t});return a>=0?(s[a].completed=!s[a].completed,b(),s[a].completed):(s.push({habitId:e,date:t,completed:!0}),b(),!0)}function H(e){var t=T(),a=t.filter(function(i){return k(e,i)}).length;return{completedDays:a,percentage:Math.round(a/7*100)}}function q(){return d.map(function(e){var t=H(e.id);return{habitName:e.name,habitId:e.id,completedDays:t.completedDays,percentage:t.percentage}})}function G(){var e=localStorage.getItem(x),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=e||(t?"dark":"light");a==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),O()}function W(){var e=document.documentElement.classList.toggle("dark");localStorage.setItem(x,e?"dark":"light"),O(),R()}function O(){var e=document.documentElement.classList.contains("dark"),t=document.getElementById("theme-icon-moon"),a=document.getElementById("theme-icon-sun");e?(t&&t.classList.add("hidden"),a&&a.classList.remove("hidden")):(t&&t.classList.remove("hidden"),a&&a.classList.add("hidden"))}function Y(e){var t={id:P(),name:e.trim()};return d.push(t),b(),t}function Z(e){d=d.filter(function(t){return t.id!==e}),s=s.filter(function(t){return t.habitId!==e}),b()}function M(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function Q(e,t){var a=k(e.id,t),i=H(e.id),n='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',o='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>',r='<div class="habit-card" data-testid="habit-card-'+e.id+'">';return r+='<div class="habit-checkbox '+(a?"checked":"")+" "+(c?"disabled":"")+'" ',r+='data-habit-id="'+e.id+'" data-testid="checkbox-habit-'+e.id+'">',r+=a?n:"",r+="</div>",r+='<div class="habit-info">',r+='<div class="habit-name '+(a?"completed":"")+'">'+M(e.name)+"</div>",r+='<div class="habit-stats">',r+='<div class="habit-progress">',r+='<div class="habit-progress-bar" style="width: '+i.percentage+'%"></div>',r+="</div>",r+='<span class="habit-percentage">'+i.percentage+"%</span>",r+="</div></div>",c||(r+='<div class="habit-actions">',r+='<button class="habit-delete-btn" data-habit-id="'+e.id+'" data-testid="button-delete-'+e.id+'" aria-label="Usuń nawyk">',r+=o,r+="</button></div>"),r+="</div>",r}function X(){var e=document.getElementById("habits-list"),t=document.getElementById("empty-habits"),a=document.getElementById("habits-count");if(!(!e||!t||!a)){if(a.textContent=String(d.length),d.length===0){e.classList.add("hidden"),t.classList.remove("hidden");var i=document.getElementById("empty-subtext");i&&(i.textContent=c?"Ten dashboard jest pusty":"Dodaj swój pierwszy nawyk powyżej");return}e.classList.remove("hidden"),t.classList.add("hidden");var n=B();e.innerHTML=d.map(function(o){return Q(o,n)}).join("")}}function $(){var e=document.getElementById("daily-habits-grid"),t=document.getElementById("today-date");if(!(!e||!t)){var a=B();if(t.textContent=A(),d.length===0){e.innerHTML='<p class="empty-text" style="grid-column: 1 / -1; text-align: center; padding: 2rem;">Brak nawyków do wyświetlenia</p>';return}var i='<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';e.innerHTML=d.map(function(n){var o=k(n.id,a),r='<div class="daily-habit-item '+(o?"completed":"")+" "+(c?"disabled":"")+'" ';return r+='data-habit-id="'+n.id+'" data-testid="daily-habit-'+n.id+'">',r+='<div class="habit-checkbox '+(o?"checked":"")+'" style="width: 1rem; height: 1rem;">',r+=o?i:"",r+="</div>",r+='<span class="daily-habit-name">'+M(n.name)+"</span>",r+="</div>",r}).join("")}}function R(){var e=document.getElementById("stats-empty"),t=document.getElementById("stats-charts");if(!(!e||!t)){if(d.length===0){e.classList.remove("hidden"),t.classList.add("hidden");return}e.classList.add("hidden"),t.classList.remove("hidden");var a=q(),i=document.documentElement.classList.contains("dark"),n=i?"hsl(0, 0%, 70%)":"hsl(0, 0%, 50%)",o=i?"hsl(0, 0%, 25%)":"hsl(0, 0%, 90%)",r=["hsl(203, 88%, 53%)","hsl(160, 100%, 36%)","hsl(42, 93%, 56%)","hsl(147, 79%, 42%)","hsl(341, 75%, 51%)"];I&&I.destroy();var u=document.getElementById("bar-chart"),m=u?u.getContext("2d"):null;m&&(I=new Chart(m,{type:"bar",data:{labels:a.map(function(l){return l.habitName}),datasets:[{label:"Dni ukończone",data:a.map(function(l){return l.completedDays}),backgroundColor:a.map(function(l,L){return r[L%r.length]}),borderRadius:6,borderSkipped:!1}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{backgroundColor:"hsl(0, 0%, 10%)",titleColor:"hsl(0, 0%, 100%)",bodyColor:"hsl(0, 0%, 100%)",padding:12,cornerRadius:8,callbacks:{label:function(l){return l.parsed.y+" dni z 7"}}}},scales:{y:{beginAtZero:!0,max:7,ticks:{stepSize:1,color:n},grid:{color:o}},x:{ticks:{color:n},grid:{display:!1}}}}}));var h=T(),v=h.map(z),g=h.map(function(l){if(d.length===0)return 0;var L=d.filter(function(j){return k(j.id,l)}).length;return Math.round(L/d.length*100)});w&&w.destroy();var f=document.getElementById("line-chart"),p=f?f.getContext("2d"):null;p&&(w=new Chart(p,{type:"line",data:{labels:v,datasets:[{label:"Średnia realizacja (%)",data:g,borderColor:"hsl(203, 88%, 53%)",backgroundColor:"hsla(203, 88%, 53%, 0.1)",fill:!0,tension:.4,pointRadius:4,pointHoverRadius:6,pointBackgroundColor:"hsl(203, 88%, 53%)",pointBorderColor:i?"hsl(0, 0%, 10%)":"white",pointBorderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{display:!1},tooltip:{backgroundColor:"hsl(0, 0%, 10%)",titleColor:"hsl(0, 0%, 100%)",bodyColor:"hsl(0, 0%, 100%)",padding:12,cornerRadius:8,callbacks:{label:function(l){return l.parsed.y+"% realizacji"}}}},scales:{y:{beginAtZero:!0,max:100,ticks:{stepSize:25,color:n,callback:function(l){return l+"%"}},grid:{color:o}},x:{ticks:{color:n},grid:{display:!1}}}}}))}}function ee(e){e.preventDefault();var t=document.getElementById("habit-input"),a=t?t.value.trim():"";a&&(Y(a),t.value="",E())}function S(e){if(!c){var t=B();_(e,t),E()}}function te(e){c||(Z(e),E())}function ae(){var e=document.getElementById("share-modal"),t=document.getElementById("share-link-input"),a=document.getElementById("copy-success");try{t&&(t.value=V()),a&&a.classList.add("hidden"),e&&e.classList.remove("hidden")}catch(i){console.error("Error generating share link:",i),alert("Wystąpił błąd podczas generowania linku udostępniania.")}}function C(){var e=document.getElementById("share-modal");e&&e.classList.add("hidden")}function ne(){var e=document.getElementById("share-link-input"),t=document.getElementById("copy-success");e&&navigator.clipboard.writeText(e.value).then(function(){t&&t.classList.remove("hidden"),setTimeout(function(){t&&t.classList.add("hidden")},3e3)})}function E(){X(),$(),R()}function re(){var e=document.getElementById("habits-list");e&&e.addEventListener("click",function(a){if(!c){var i=a.target,n=i.closest(".habit-checkbox");if(n&&!n.classList.contains("disabled")){var o=n.dataset.habitId;o&&S(o);return}var r=i.closest(".habit-delete-btn");if(r){var o=r.dataset.habitId;o&&te(o);return}}});var t=document.getElementById("daily-habits-grid");t&&t.addEventListener("click",function(a){if(!c){var i=a.target,n=i.closest(".daily-habit-item");if(n&&!n.classList.contains("disabled")){var o=n.dataset.habitId;o&&S(o)}}})}function ie(){G();var e=new URLSearchParams(window.location.search),t=e.has("shared"),a=J();if(t){c=!0;var i=document.getElementById("add-habit-section"),n=document.getElementById("read-only-badge"),o=document.getElementById("share-btn");i&&i.classList.add("hidden"),n&&n.classList.remove("hidden"),o&&o.classList.add("hidden"),a?(d=a.habits||[],s=a.completions||[]):(d=[],s=[])}else{c=!1;var r=N();d=r.habits||[],s=r.completions||[];var i=document.getElementById("add-habit-section"),n=document.getElementById("read-only-badge"),o=document.getElementById("share-btn");i&&i.classList.remove("hidden"),n&&n.classList.add("hidden"),o&&o.classList.remove("hidden")}var u=document.getElementById("add-habit-form"),m=document.getElementById("theme-toggle"),h=document.getElementById("share-btn"),v=document.getElementById("modal-close"),g=document.getElementById("copy-link-btn"),f=document.querySelector(".modal-backdrop");u&&u.addEventListener("submit",ee),m&&m.addEventListener("click",W),h&&h.addEventListener("click",ae),v&&v.addEventListener("click",C),g&&g.addEventListener("click",ne),f&&f.addEventListener("click",C),document.addEventListener("keydown",function(p){p.key==="Escape"&&C()}),re(),E(),y&&K()}document.addEventListener("DOMContentLoaded",ie);
